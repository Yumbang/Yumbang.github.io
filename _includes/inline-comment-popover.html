<!-- Inline Comment Popover Component -->
<!-- This popover appears when users click on a paragraph's comment icon -->
<!-- Dynamically positioned and populated by JavaScript -->

<div class="inline-comment-popover"
     data-para-id="{{ include.para_id }}"
     role="dialog"
     aria-modal="true"
     aria-labelledby="popover-title-{{ include.para_id }}"
     style="display: none;">

  <!-- Popover Header -->
  <div class="popover-header">
    <h4 id="popover-title-{{ include.para_id }}" class="popover-title">Comment on this paragraph</h4>
    <button class="popover-close"
            type="button"
            aria-label="Close comment dialog"
            data-dismiss="popover">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>

  <!-- Popover Body -->
  <div class="popover-body">

    <!-- Loading State -->
    <div class="popover-loading" style="display: none;">
      <div class="loading-spinner" role="status" aria-live="polite">
        <span class="visually-hidden">Loading comments...</span>
      </div>
    </div>

    <!-- Existing Comments on This Paragraph -->
    <div class="existing-comments" role="region" aria-label="Existing comments on this paragraph">
      <!-- Populated dynamically by JavaScript -->
      <!-- Format:
      <div class="inline-comment-item">
        <div class="comment-author">
          <img src="avatar.jpg" alt="Author Name" class="comment-avatar">
          <span class="comment-author-name">Author Name</span>
          <time class="comment-date" datetime="ISO">Date</time>
        </div>
        <div class="comment-body">Comment text...</div>
      </div>
      -->
    </div>

    <!-- No Comments State -->
    <div class="no-comments" style="display: none;">
      <p class="text-muted">Be the first to comment on this paragraph.</p>
    </div>

    <!-- New Comment Form -->
    <div class="new-comment-form">
      <form class="comment-form" data-para-id="{{ include.para_id }}">
        <div class="form-group">
          <label for="comment-input-{{ include.para_id }}" class="visually-hidden">
            Your comment on this paragraph
          </label>
          <textarea
            id="comment-input-{{ include.para_id }}"
            class="comment-input"
            placeholder="Add your comment..."
            rows="3"
            required
            aria-required="true"
            aria-describedby="comment-hint-{{ include.para_id }}"></textarea>
          <div id="comment-hint-{{ include.para_id }}" class="form-hint">
            Your comment will be posted via GitHub Discussions. Sign in with GitHub to comment.
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-cancel" data-dismiss="popover">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary btn-submit">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" style="margin-right: 0.25rem;">
              <path d="M2.5 2A1.5 1.5 0 0 1 4 .5h8A1.5 1.5 0 0 1 13.5 2v8a1.5 1.5 0 0 1-1.5 1.5H6.5l-3 3v-3H2.5A1.5 1.5 0 0 1 1 10V2.5A1.5 1.5 0 0 1 2.5 2z"/>
            </svg>
            Comment
          </button>
        </div>
      </form>
    </div>

    <!-- Error State -->
    <div class="comment-error" role="alert" aria-live="assertive" style="display: none;">
      <p class="error-message"></p>
    </div>

  </div>

  <!-- Popover Arrow (points to paragraph) -->
  <div class="popover-arrow" aria-hidden="true"></div>

</div>
